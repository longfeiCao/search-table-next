import{pushScopeId as e,popScopeId as t,computed as a,reactive as l,ref as o,onMounted as r,resolveComponent as n,openBlock as i,createBlock as s,Fragment as u,createVNode as c,unref as d,renderList as p,createCommentVNode as f,createTextVNode as m,toDisplayString as y,renderSlot as g,createSlots as v,withScopeId as b}from"vue";import{ExclamationCircleOutlined as h}from"@ant-design/icons-vue";import{notification as w,Modal as k}from"ant-design-vue";const S=(e,t)=>{if(!t)return e;let a=Object.prototype.toString.call(e),l=Object.prototype.toString.call(t);if("[object Object]"===a)if("[object String]"==l){let a=t.split(".");if(a.length>0){for(let t=0;t<a.length;t++){const l=a[t];if(!e[l]){console.error(`field ${l} 不存在`);break}e=e[l]}return e}}else console.warn("result field props String please");else console.warn("data 数据类型不是一个对象")},x=b("data-v-3a5b88a3");e("data-v-3a5b88a3");const j=m("筛 选"),C=m("重 置"),P={class:"mb10"},_={style:{float:"right",margin:"10px 0"}};t();var O={props:{apiFun:{type:String,default:""},fetchOptions:{type:Object,default:{url:"",method:"get",headers:{}}},resultField:{type:String,default:"list"},totalField:{type:String,default:"total"},showSelection:{type:Boolean,default:!1},editText:{type:String,default:"编辑"},delText:{type:String,default:"删除"},selectionCfg:{type:Object,default:{type:"checkbox"}},propsParams:{type:Object,default:{}},filterForm:{type:Array,default:[]},columns:{type:Array,default:[]}},emits:["edit","del"],setup(e,{expose:t,emit:b}){const O=e,F=a((()=>T.columns.filter((e=>e.slots&&"defaultAction"!==e.slots.customRender)).map((e=>e.slots))));let T=l({total:10,pages:{currentPage:1,pageSize:10},queryParams:{},tableLoading:!1,tableData:[],columns:[]});const q=(e,t)=>{console.log(e,t),T.pages.currentPage=e,D()},U=e=>{Object.keys(e).forEach((t=>{e[t]=""}))},D=async()=>{if(O.apiFun||O.fetchOptions.url){T.tableLoading=!0;try{let{pages:e,queryParams:t}=T,a={};if(O.apiFun)a=await O.apiFun({...e,...t,...O.propsParams});else{let{url:l,method:o,headers:r,...n}=O.fetchOptions,i={...e,...t,...O.propsParams},s={url:l,method:o,headers:{"content-type":"application/json; charset=utf-8",...r},...n};"GET"!==o.toUpperCase()&&(s.body=JSON.stringify(i));let u="GET"==o.toUpperCase()?`${l}${(e=>{if("[object Object]"!==Object.prototype.toString.call(e))return void console.warn("body 参数不是对象");let t=[];return Object.keys(e).forEach((a=>{t.push(a+"="+e[a])})),"?"+t.join("&")})(i)}`:l,c=await fetch(u,s);a=await c.json()}T.tableData=S(a,O.resultField),T.total=S(a,O.totalField),$(T.tableData),T.tableLoading=!1}catch(e){w.error({message:"【apiFun】接口名称错误",description:"错误信息："+e}),T.tableLoading=!1}}else w.error({message:"前端接口地址不存在",description:"filterTable组件的【apiFun 或 fetch.url】不能为空！"})},A=o([]),Y=(e,t)=>{A.value=e},$=e=>{if(Array.isArray(e)&&e.length>0)if(Array.isArray(O.columns)&&O.columns.length>0)T.columns=O.columns;else{let t=e[0],a=Object.keys(t).map((e=>({title:e,dataIndex:e})));T.columns=a}};r((()=>{let{selectionCfg:e}=O;var t;"[object Function]"!==(t=e.onChange,Object.prototype.toString.call(t))&&(e.onChange=Y),e.rowKey||(e.rowKey=(e,t)=>t),D()}));return t({selectionData:A,initTableData:D}),(t,a)=>{const l=n("a-input"),o=n("a-form-item"),r=n("a-select-option"),w=n("a-select"),S=n("a-date-picker"),A=n("a-range-picker"),Y=n("a-col"),$=n("a-button"),z=n("a-row"),E=n("a-form"),I=n("a-table"),K=n("a-pagination");return i(),s(u,null,[c(E,{model:d(T).queryParams},{default:x((()=>[c(z,{gutter:15,class:"filter"},{default:x((()=>[(i(!0),s(u,null,p(e.filterForm,(e=>(i(),s(Y,{class:"item",key:e.value},{default:x((()=>["input"==e.type?(i(),s(o,{key:0,label:""},{default:x((()=>[c(l,{value:d(T).queryParams[e.value],"onUpdate:value":t=>d(T).queryParams[e.value]=t,placeholder:`请输入${e.label}`},null,8,["value","onUpdate:value","placeholder"])])),_:2},1024)):f("v-if",!0),"select"==e.type?(i(),s(o,{key:1,label:""},{default:x((()=>[c(w,{value:d(T).queryParams[e.value],"onUpdate:value":t=>d(T).queryParams[e.value]=t,placeholder:`请选择${e.label}`},{default:x((()=>[(i(!0),s(u,null,p(e.options,(e=>(i(),s(r,{key:e.value,value:e.value},{default:x((()=>[m(y(e.text),1)])),_:2},1032,["value"])))),128))])),_:2},1032,["value","onUpdate:value","placeholder"])])),_:2},1024)):f("v-if",!0),"date"==e.type?(i(),s(o,{key:2,label:""},{default:x((()=>[c(S,{value:d(T).queryParams[e.value],"onUpdate:value":t=>d(T).queryParams[e.value]=t,valueFormat:"YYYY-MM-DD",style:{width:"100%"}},null,8,["value","onUpdate:value"])])),_:2},1024)):f("v-if",!0),"daterange"==e.type?(i(),s(o,{key:3,label:""},{default:x((()=>[c(A,{value:d(T).queryParams[e.value],"onUpdate:value":t=>d(T).queryParams[e.value]=t,valueFormat:"YYYY-MM-DD",style:{width:"100%"}},null,8,["value","onUpdate:value"])])),_:2},1024)):f("v-if",!0)])),_:2},1024)))),128)),g(t.$slots,"formItem"),f(' <a-col class="item" style="width:25%;">\r\n        <a-form-item label="">\r\n          <a-input-number style="width:100%;"></a-input-number>   \r\n        </a-form-item>\r\n     </a-col> '),c(Y,{class:"btnItem mb10 text-right"},{default:x((()=>[c($,{type:"primary",class:"mr10",onClick:a[1]||(a[1]=e=>{D()})},{default:x((()=>[j])),_:1}),c($,{type:"ghost",onClick:a[2]||(a[2]=e=>(U(T.queryParams),void U(O.propsParams)))},{default:x((()=>[C])),_:1})])),_:1})])),_:3})])),_:1},8,["model"]),c("div",P,[g(t.$slots,"extra")]),c(I,{rowKey:e.selectionCfg.rowKey,loading:d(T).tableLoading,"row-selection":e.showSelection?e.selectionCfg:null,columns:d(T).columns,pagination:!1,"data-source":d(T).tableData},v({defaultAction:x((({record:t})=>[c($,{type:"primary",onClick:e=>{b("edit",t)}},{default:x((()=>[m(y(e.editText),1)])),_:2},1032,["onClick"]),c($,{style:{"margin-left":"5px"},onClick:e=>{return a=t,void k.confirm({title:"删除提示",icon:c(h),content:"此操作将删除该条数据, 是否继续?",okText:"确认",cancelText:"取消",onCancel(){},onOk(){b("del",a,(()=>{D()}))}});var a}},{default:x((()=>[m(y(e.delText),1)])),_:2},1032,["onClick"])])),_:2},[p(d(F),(e=>({name:e.customRender,fn:x((({record:a})=>[g(t.$slots,e.customRender,{record:a})]))})))]),1032,["rowKey","loading","row-selection","columns","data-source"]),c("div",_,[c(K,{"show-size-changer":"",current:d(T).pages.currentPage,"onUpdate:current":a[3]||(a[3]=e=>d(T).pages.currentPage=e),pageSize:d(T).pages.pageSize,"onUpdate:pageSize":a[4]||(a[4]=e=>d(T).pages.pageSize=e),total:d(T).total,onChange:q},null,8,["current","pageSize","total"])])],64)}}};!function(e,t){void 0===t&&(t={});var a=t.insertAt;if(e&&"undefined"!=typeof document){var l=document.head||document.getElementsByTagName("head")[0],o=document.createElement("style");o.type="text/css","top"===a&&l.firstChild?l.insertBefore(o,l.firstChild):l.appendChild(o),o.styleSheet?o.styleSheet.cssText=e:o.appendChild(document.createTextNode(e))}}("\n.filter[data-v-3a5b88a3]{\r\n  display: flex;\r\n  justify-content: space-between;\n}\n.filter .item[data-v-3a5b88a3]{\r\n  width: 25%;\n}\n.filter .btnItem[data-v-3a5b88a3]{\r\n  flex: auto;\n}\r\n"),O.__scopeId="data-v-3a5b88a3",O.__file="package/search-table/index.vue",console.log(O),O.install=function(e){e.component(O.name,O)};export{O as default};
